<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title type="text">Recent Blog Posts</title>
  <id>http://blog.o1iver.net/feed.atom</id>
  <updated>2011-11-17T00:00:00Z</updated>
  <link href="http://blog.o1iver.net/" />
  <link href="http://blog.o1iver.net/feed.atom" rel="self" />
  <subtitle type="text">Recent blog posts</subtitle>
  <generator>Werkzeug</generator>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Snap Framework Basics</title>
    <id>http://blog.o1iver.net/2011/11/17/snap-framework-basics</id>
    <updated>2011-11-17T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/11/17/snap-framework-basics" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;p&gt;I usually develop in Python, although that has more to do with the languages look-and-feel than anything else. After almost ten years of progamming I have come to the conclusion that that is one of the most important aspects of a language. If you like static-typing use something like Java/C#, if you don't use Python or Ruby or whatever else you like. Anyway that doesn't really matter right now (although I might try to write down my thoughts about this some time). The thing is that a few months ago I first had a look at &lt;a class="reference external" href="http://haskell.org"&gt;Haskell&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Haskell is a beauty. If Java is a Volswagen Golf and Python a BMW M3, then Haskell is a Porsche Carrera GT, incredible, but hard to drive. The second I finally understood what Haskell was about, I knew that it was going to become my go-to language in the future (once I get it :-). So after dabbling around for a while I thought it was time to have a look at how suited Haskell is for web development and that is where the &lt;a class="reference external" href="http://snapframework.com/"&gt;Snap Framework&lt;/a&gt; comes into play. From the site:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Snap is a simple web development framework for unix systems, written in the Haskell programming language. Snap has a high level of test coverage and is well-documented.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Installation was very easy:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;cabal install snap
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So below are a few simple examples that I am playing with to get a hang of the framework before I can build a real project with it (already have an idea for that).&lt;/p&gt;
&lt;div class="section" id="getting-the-request-method"&gt;
&lt;h2&gt;Getting the request method&lt;/h2&gt;
&lt;p&gt;The first thing I tried to figure out was how to get information about the request. Here is a request handler that simply prints out a request's HTTP method. With this as a basis it becomes pretty obvious how to extract other information such as the request URI, headers, etc.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;methodHandler&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;methodStr&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="n"&gt;rqMethod&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;$&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;getRequest&lt;/span&gt;
    &lt;span class="n"&gt;writeBS&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="kt"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pack&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;methodStr&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="using-different-handlers-with-the-same-route-depending-on-request-parameters"&gt;
&lt;h2&gt;Using different handlers with the same route (depending on request parameters)&lt;/h2&gt;
&lt;p&gt;Although you could use the above mentioned method of getting a request's method to handle these differently using cases or ifs/thens, there is an idiom for returning different responses depending on the request headers. It is based on the &amp;quot;&amp;lt;|&amp;gt;&amp;quot; function. Here is an example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;indexHandler&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="kt"&gt;GET&lt;/span&gt;  &lt;span class="n"&gt;indexGet&lt;/span&gt;
            &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="kt"&gt;POST&lt;/span&gt; &lt;span class="n"&gt;indexPost&lt;/span&gt;
            &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;errorHandler&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So what is going on here? Well it's actually pretty simple and entirely based on Snap's implementation of the &lt;a class="reference external" href="http://hackage.haskell.org/packages/archive/base/4.4.1.0/doc/html/Control-Applicative.html#v:-60--124--62-"&gt;Alternatives' &amp;quot;associative binary operator&amp;quot; (&amp;lt;|&amp;gt;)&lt;/a&gt;. The &lt;em&gt;&amp;lt;|&amp;gt;&lt;/em&gt; operator allows you to &lt;em&gt;try&lt;/em&gt; a certain handler, but specify following ones in case the former fails. This is what we are doing here. We are saying if the method is &lt;em&gt;GET&lt;/em&gt; use the &lt;em&gt;indexGet&lt;/em&gt; handler, if it is &lt;em&gt;POST&lt;/em&gt; use the &lt;em&gt;indexPost&lt;/em&gt; handler. If it is neither then use the &lt;em&gt;errorHandler&lt;/em&gt;. How is this done? Well here is the description of the method function:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;method&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;MonadSnap&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="ow"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Method&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;aSource&lt;/span&gt;
&lt;span class="c1"&gt;-- Runs a Snap monad action only if the request&amp;#39;s HTTP method matches the given method.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So you give the method function a &lt;a class="reference external" href="http://hackage.haskell.org/packages/archive/snap-core/0.6.0.1/doc/html/Snap-Core.html#t:Method"&gt;Method&lt;/a&gt; and a handler, then the handler action will be completed if and only if the request's method is the same as the given one. If the methods do not matche the method function will call &lt;a class="reference external" href="http://hackage.haskell.org/packages/archive/snap-core/0.6.0.1/doc/html/Snap-Core.html#v:pass"&gt;pass&lt;/a&gt; and the handler will fail, resulting in the next handler being tried (&lt;em&gt;method POST indexPost&lt;/em&gt;). If you want to see how exactly this happens have a look the &lt;a class="reference external" href="http://hackage.haskell.org/packages/archive/snap-core/0.6.0.1/doc/html/src/Snap-Internal-Types.html#method"&gt;method function source&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="c1"&gt;-- | Runs a &amp;#39;Snap&amp;#39; monad action only if the request&amp;#39;s HTTP method matches&lt;/span&gt;
&lt;span class="c1"&gt;-- the given method.&lt;/span&gt;
&lt;span class="nf"&gt;method&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;MonadSnap&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="ow"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Method&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
&lt;span class="nf"&gt;method&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;action&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
    &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;getRequest&lt;/span&gt;
    &lt;span class="n"&gt;unless&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;rqMethod&lt;/span&gt; &lt;span class="n"&gt;req&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;pass&lt;/span&gt;
    &lt;span class="n"&gt;action&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that you can chain these &lt;em&gt;checks&lt;/em&gt; to create more advanced request handlers. See this extended example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;indexHandler&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;ifTop&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="kt"&gt;GET&lt;/span&gt;  &lt;span class="n"&gt;indexGet&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;ifTop&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="kt"&gt;POST&lt;/span&gt; &lt;span class="n"&gt;indexPost&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;errorHandler&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we are not only checking the request method but also whether or not the request URI is &lt;em&gt;top&lt;/em&gt; (yes, I agree that this function name is not ideal). Here is the ifTop method description and type:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;ifTop&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;MonadSnap&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="ow"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;aSource&lt;/span&gt;
&lt;span class="c1"&gt;-- Runs a Snap monad action only when rqPathInfo is empty.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What does this mean? Well &lt;em&gt;rqPathInfo&lt;/em&gt; return the request's URI's path part that is not covered by the route declaration. If your route is &amp;quot;/posts/2011/&amp;quot; a request for &amp;quot;/posts/2011/11/17/&amp;quot; may still be routed to the specified request handler. The difference will be that in the former case &lt;em&gt;rqPathInfo&lt;/em&gt; will return an empty string and in the latter case it will return &lt;em&gt;11/17/&lt;/em&gt;. So using &lt;em&gt;ifTop&lt;/em&gt; allows you to say &lt;em&gt;the request URI may not be longer than the one specified in the routing scheme&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;But to get back to the point of how to handle different request headers: what this is meant to show is that you can chain different types of request checks to route a request to the correct handler.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="complete-routing-example"&gt;
&lt;h2&gt;Complete routing example&lt;/h2&gt;
&lt;p&gt;Here is a complete routing and handling example for an application that I am currently developing:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;indexHandler&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ifTop&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="kt"&gt;GET&lt;/span&gt;  &lt;span class="n"&gt;indexHandler&amp;#39;&lt;/span&gt;
                   &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;genericError&lt;/span&gt; &lt;span class="mi"&gt;405&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Method Not Allowed&amp;quot;&lt;/span&gt;
               &lt;span class="p"&gt;)&lt;/span&gt;
           &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;error404&lt;/span&gt; &lt;span class="c1"&gt;-- will catch any routing error (even for other request&lt;/span&gt;
                         &lt;span class="c1"&gt;-- URIs as this is the fallback route &amp;quot;/&amp;quot;)&lt;/span&gt;

&lt;span class="nf"&gt;generateHandler&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ifTop&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="kt"&gt;GET&lt;/span&gt; &lt;span class="n"&gt;generateHandler&amp;#39;&lt;/span&gt;
                      &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;error405&lt;/span&gt;
                  &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;registeredHandler&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;ifTop&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="kt"&gt;GET&lt;/span&gt; &lt;span class="n"&gt;registeredHandler&amp;#39;&lt;/span&gt;
                        &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;error405&lt;/span&gt;
                    &lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;indexHandler&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="c1"&gt;-- application logic&lt;/span&gt;
  &lt;span class="n"&gt;writeBS&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="kt"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pack&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;index page&amp;quot;&lt;/span&gt;

&lt;span class="nf"&gt;generateHandler&amp;#39;&lt;/span&gt;  &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;expr&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;fromMaybe&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;$&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;getParam&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;expr&amp;quot;&lt;/span&gt;&lt;span class="nf"&gt;\&lt;/span&gt;
  &lt;span class="c1"&gt;-- application logic&lt;/span&gt;
  &lt;span class="n"&gt;writeBS&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="n"&gt;append&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pack&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;API.generate: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;expr&lt;/span&gt;

&lt;span class="nf"&gt;registeredHandler&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;domain&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;fromMaybe&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;$&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;getParam&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;domain&amp;quot;&lt;/span&gt;
  &lt;span class="c1"&gt;-- application logic&lt;/span&gt;
  &lt;span class="n"&gt;writeBS&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="n"&gt;append&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pack&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;API.registered: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="n"&gt;domain&lt;/span&gt;

&lt;span class="nf"&gt;error404&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;genericError&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Not Found&amp;quot;&lt;/span&gt;
&lt;span class="nf"&gt;error405&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;genericError&lt;/span&gt; &lt;span class="mi"&gt;405&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Method Not Allowed&amp;quot;&lt;/span&gt;

&lt;span class="nf"&gt;genericError&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="kr"&gt;do&lt;/span&gt;
  &lt;span class="n"&gt;modifyResponse&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="n"&gt;setResponseStatus&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="kt"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pack&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;
  &lt;span class="n"&gt;writeBS&lt;/span&gt; &lt;span class="o"&gt;$&lt;/span&gt; &lt;span class="kt"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pack&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;show&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="s"&gt;&amp;quot; - &amp;quot;&lt;/span&gt; &lt;span class="o"&gt;++&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="ow"&gt;&amp;lt;-&lt;/span&gt; &lt;span class="n"&gt;getResponse&lt;/span&gt;
  &lt;span class="n"&gt;finishWith&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;

&lt;span class="c1"&gt;------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="c1"&gt;-- | The main entry point handler.&lt;/span&gt;
&lt;span class="nf"&gt;site&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;Application&lt;/span&gt; &lt;span class="nb"&gt;()&lt;/span&gt;
&lt;span class="nf"&gt;site&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;route&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/&amp;quot;&lt;/span&gt;                           &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;indexHandler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
             &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/api/generate/:expr/&amp;quot;&lt;/span&gt;        &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;generateHandler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
             &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/api/registered/:domain/&amp;quot;&lt;/span&gt;    &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;registeredHandler&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
             &lt;span class="p"&gt;]&lt;/span&gt;
       &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;serveDirectory&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;resources/static&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see these handlers combine both &lt;em&gt;method&lt;/em&gt; and &lt;em&gt;ifTop&lt;/em&gt; to check whether a request's HTTP method is right and whether or not the request URI contains additional unwanted path segements. Here are a few examples of requests and the server's response:&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;::&lt;/dt&gt;
&lt;dd&gt;&lt;p class="first"&gt;request:  GET /
response: HTTP/1.1 200 OK&lt;/p&gt;
&lt;div class="system-message"&gt;
&lt;p class="system-message-title"&gt;System Message: ERROR/3 (&lt;tt class="docutils"&gt;&amp;lt;string&amp;gt;&lt;/tt&gt;, line 137)&lt;/p&gt;
Unexpected indentation.&lt;/div&gt;
&lt;blockquote&gt;
index page&lt;/blockquote&gt;
&lt;p&gt;request:  POST /
response: HTTP/1.1 405 Method Not Allowed&lt;/p&gt;
&lt;div class="system-message"&gt;
&lt;p class="system-message-title"&gt;System Message: ERROR/3 (&lt;tt class="docutils"&gt;&amp;lt;string&amp;gt;&lt;/tt&gt;, line 141)&lt;/p&gt;
Unexpected indentation.&lt;/div&gt;
&lt;blockquote&gt;
405 - Method Not Allowed&lt;/blockquote&gt;
&lt;p&gt;request:  GET /api/
response: HTTP/1.1 404 Not Found&lt;/p&gt;
&lt;div class="system-message"&gt;
&lt;p class="system-message-title"&gt;System Message: ERROR/3 (&lt;tt class="docutils"&gt;&amp;lt;string&amp;gt;&lt;/tt&gt;, line 145)&lt;/p&gt;
Unexpected indentation.&lt;/div&gt;
&lt;blockquote&gt;
404 - Not Found&lt;/blockquote&gt;
&lt;p&gt;request:  POST /api/
response: HTTP/1.1 404 Not Found&lt;/p&gt;
&lt;div class="system-message"&gt;
&lt;p class="system-message-title"&gt;System Message: ERROR/3 (&lt;tt class="docutils"&gt;&amp;lt;string&amp;gt;&lt;/tt&gt;, line 149)&lt;/p&gt;
Unexpected indentation.&lt;/div&gt;
&lt;blockquote&gt;
404 - Not Found&lt;/blockquote&gt;
&lt;p&gt;request:  GET /api/generate/abc
response: HTTP/1.1 200 OK&lt;/p&gt;
&lt;div class="system-message"&gt;
&lt;p class="system-message-title"&gt;System Message: ERROR/3 (&lt;tt class="docutils"&gt;&amp;lt;string&amp;gt;&lt;/tt&gt;, line 153)&lt;/p&gt;
Unexpected indentation.&lt;/div&gt;
&lt;blockquote&gt;
API.generate: abc&lt;/blockquote&gt;
&lt;p&gt;request:  PUT /api/registered/google.com
response: HTTP/1.1 405 Method Not Allowed&lt;/p&gt;
&lt;div class="system-message"&gt;
&lt;p class="system-message-title"&gt;System Message: ERROR/3 (&lt;tt class="docutils"&gt;&amp;lt;string&amp;gt;&lt;/tt&gt;, line 157)&lt;/p&gt;
Unexpected indentation.&lt;/div&gt;
&lt;blockquote class="last"&gt;
405 - Method Not Allowed&lt;/blockquote&gt;
&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;Although the above method works as intended it is not as &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Don't_repeat_yourself"&gt;DRY&lt;/a&gt; as possible. Because the route function takes a handler as an argument we can actually do the &lt;em&gt;ifTop&lt;/em&gt; and &lt;em&gt;method&lt;/em&gt; checks in the route definition (and declare a &lt;em&gt;methodOrError405&lt;/em&gt; helper function):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nf"&gt;methodOrError405&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;Method&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Application&lt;/span&gt; &lt;span class="nb"&gt;()&lt;/span&gt; &lt;span class="ow"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Application&lt;/span&gt; &lt;span class="nb"&gt;()&lt;/span&gt;
&lt;span class="nf"&gt;methodOrError405&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;
                   &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;error405&lt;/span&gt;

&lt;span class="nf"&gt;site&lt;/span&gt; &lt;span class="ow"&gt;::&lt;/span&gt; &lt;span class="kt"&gt;Application&lt;/span&gt; &lt;span class="nb"&gt;()&lt;/span&gt;
&lt;span class="nf"&gt;site&lt;/span&gt; &lt;span class="ow"&gt;=&lt;/span&gt; &lt;span class="n"&gt;route&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/&amp;quot;&lt;/span&gt;                           &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ifTop&lt;/span&gt; &lt;span class="n"&gt;indexHandler&lt;/span&gt;                               &lt;span class="p"&gt;)&lt;/span&gt;
             &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/api/generate/:expr/&amp;quot;&lt;/span&gt;        &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ifTop&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;methodOrError405&lt;/span&gt; &lt;span class="kt"&gt;GET&lt;/span&gt; &lt;span class="n"&gt;generateHandler&amp;#39;&lt;/span&gt;  &lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="p"&gt;)&lt;/span&gt;
             &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;/api/registered/:domain/&amp;quot;&lt;/span&gt;    &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ifTop&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;methodOrError405&lt;/span&gt; &lt;span class="kt"&gt;GET&lt;/span&gt; &lt;span class="n"&gt;registeredHandler&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="p"&gt;)&lt;/span&gt;
             &lt;span class="p"&gt;]&lt;/span&gt;
       &lt;span class="o"&gt;&amp;lt;|&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;serveDirectory&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;resources/static&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This produces the exact same results as above. &lt;em&gt;Note that we no longer define the handler as fooBar, but rather at fooBar' directly (without the checks).&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Markov Chain Text Generator</title>
    <id>http://blog.o1iver.net/2011/11/12/markov-chain-text-generator</id>
    <updated>2011-11-12T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/11/12/markov-chain-text-generator" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;div class="section" id="markov-chain-text-generator"&gt;
&lt;h2&gt;Markov Chain Text Generator&lt;/h2&gt;
&lt;p&gt;The topic of my bachelor thesis (work in progress) is &amp;quot;Markov Decision Processes for Optimal Control (of Waste-to-Energy Plants)&amp;quot;. This is a super interesting topic and I am having lots of fun playing with MDPs. MDPs are actually an extension of Markov Chains. I am not going to go through Markov Chains in great detail, but there are two things that must be said.&lt;/p&gt;
&lt;div class="section" id="markov-property"&gt;
&lt;h3&gt;Markov Property&lt;/h3&gt;
&lt;p&gt;The Markov property states, that future states only depend on the current state. If the Markov Property holds for a certain stochastic process you can say, that the process is &amp;quot;memoryless&amp;quot;!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="transition-probabilities"&gt;
&lt;h3&gt;Transition Probabilities&lt;/h3&gt;
&lt;p&gt;A transition probability describes the likelyhood of going from a certain state to another state (in the next epoch). Consider the following two state example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;- State 1: relationship status is &lt;span class="s1"&gt;&amp;#39;single&amp;#39;&lt;/span&gt;
- State 2: relationship status is &lt;span class="s1"&gt;&amp;#39;in a relationship&amp;#39;&lt;/span&gt;
- State 3: relationship status is &lt;span class="s1"&gt;&amp;#39;engaged&amp;#39;&lt;/span&gt;
- State 4: relationship status is &lt;span class="s1"&gt;&amp;#39;married&amp;#39;&lt;/span&gt;
- State 5: relationship status is &lt;span class="s1"&gt;&amp;#39;divorced&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now the transition probabilities (they are represented as a matrix):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;              s i n k
s |-----------------------------|
o | 0.7 | 0.3 | 0.0 | 0.0 | 0.0 |
u | 0.2 | 0.7 | 0.1 | 0.0 | 0.0 |
r | 0.1 | 0.0 | 0.2 | 0.7 | 0.0 |
c | 0.0 | 0.1 | 0.0 | 0.7 | 0.2 |
e | 0.0 | 0.3 | 0.0.| 0.0 | 0.7 |
  |-----------------------------|
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So what does this mean? Well the rows correspond to source states (current state) and the columns to sink states (next state), and the numbers represent the probability of transitioning from the given source to the given sink state. So for example, let's look at the second row. Being in this row means that the person this represents is in a relationship. The numbers in the row define the probability of which state will be reached at the next epoch. So for example the 0.2 in the first column means that there is a 20% probability of going from being in a relationship to being single again. Or the last column: the probability of going to state 'divorced' is 0.0. This makes sense as it is impossible to become divorced if you are not married yet!&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I hope that made sense.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="text-generation-using-markov-chains"&gt;
&lt;h2&gt;Text Generation using Markov Chains&lt;/h2&gt;
&lt;p&gt;So now come the fun part. Firstly: how in the world is this stuff going to help me generate text? Well actually it is very simple. What we do is we say that words are states and transition probabilities describe the probabilty of a certain word following another word. What this means is that we can use a certain training text to extract the probabilities of for example the word 'world' following the word 'hello'. Does that make sense? Let me repeat that to be clear. We use a training text to build a transition probability matrix, which we can then use to generate a text by using these &lt;em&gt;word A follows word B&lt;/em&gt; probabilities.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: when I say word, I actually mean token, so even exclamation marks and commas count as word in this context.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;To give you an example of a generated text. Here is a text (1000 words) that I generated using a transition probability matrix extracted from the borther Grimms' fairy tales:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The countryman.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The two oxen a good children.! Cried he took the wind, and trotted away about the money upon the boar ran about, and watched for himself down and crept into the horse and had eaten this is all was about, took my neighbours, took his road; They went the forest. So beautiful roses that you here she would like to be managed to set up than old ones. Their brother fortune would do not one evening, away, and try what have a fine fat goose, who were tired;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The ale that it was, just before the well taken from my wife said the youngest said, and when he tasted very easily get me? Said sorrowfully. Then said she did they could hardly hold your wife were not straight over upon it, so that he met with me into the monster stood on her great grief came nearer they should be black friend? Asked him into a golden goblet full of your body, and his time of life as they came and guess what we were discovered in the third night, and said, if he should give them all had once again asked the bottle, gretel. The same time and they were too wished himself. But the little dwarf should be away curdken ran into my heart, said the cat said the stick, and cried the maiden, who had flown out. And the miller wife was once more beautiful ring as she cut down on the promised to the way home, and when she had enough yet. He is tired him: the ground. But gretel, like to sleep for the king said, gretel thought: so whilst they set to draw beer. Then he consented, and the walls; So he was, and it; And shall not gone; Whom everyone wondered if you go a little way when he died of gold? Asked in the cupboard, and out at length agreed to a young girl remained sticking fast. In upon the young lady is only said he lifted its liberty, bury my brown, and dug his mind and rolled on her head that the forest dwelt, hans.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;So frightened me! The queen went down and that at him. Have worked and rode up. Wo you may get rid of him and he did not yourself, till she. Think, answered: a strong, he jogged, and overset the miller, old song was to the salad ready, and waited a dove?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;She was thrown at last a handful of the four years had said the sexton when he should at the village, no evil would, my order that he answered the middle of the juniper-tree kywitt, and was rich, whose lives here?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Asked what have been made her, who asked he called out of no one side of any longer the ring, and kicked him to the hill and said he married king son said:, and ask her own house, and spun gold, they saw your little friend again this frightened, he was jumping about what she flew away; Give you no one blow, and wait until that he could want you old as day, and I to take them ran catherine, would? Said, darting. Then went inside it again.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The old song was carried away one of gold; The lion, but devoured her say, shall not believe that he named gretel presents hans took my end to sit and eat, would be able to give them on jollily together, I am beginning to do or seen the prince said the other, she walked into bed.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;It seemed as in one day, and we are you seek for it, just tell no injury. The juniper-tree stood all three hundred paces to him. Let her.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The merry and once more than money in every hole where they are the parson house. The other after all the princess was always stand godmother; And he was bewitched by the king said the dog. These should have got up the musicians an end of spirits, when it was again over him.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Then another of cloth it happened before the forest, and opened. The house: and then the old nail in the power to the murderers den, little dwarf met them out with you, and the twenty of the feast, and said to run and would not see what is cast into the water the second son. In the morning just then they were some more glad indeed! Said her up she began to the cat entirely emptied the fox with the sea! Said, the water.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The way over my face and the town, all his money to awaken him once more piece of cold and next day more pipe and put her best way, mr korbes came and sit still, she came close by me, asked how falada again. The gold, like big that everyone called all went back and saw that nothing but the wind, and the well married; I saw them as you get out my map, we will give a beautiful sleeping on a shame that she, the king, and expected to earn his teeth?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;In a draught, and as he went over upon that you the same day frederick and that the goat who was glad, I shall die, and will go.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="generator-code"&gt;
&lt;h2&gt;Generator Code&lt;/h2&gt;
&lt;p&gt;The code is available at &lt;a class="reference external" href="http://github.com/o1iver/markov-text-generator"&gt;http://github.com/o1iver/markov-text-generator&lt;/a&gt;. To generate text run the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;python mg.py &amp;lt;training-text-file&amp;gt; &amp;lt;output-file&amp;gt; &amp;lt;number-of-words&amp;gt; &amp;lt;num-states-factor&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;python mg.py grimm.txt out.txt 1000 0.4
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Note: that last value is a factor that defines how many words from the traning text should be used. If you have a very large text with many different words the number of words (= number of states) can become very large. Using that parameter you can define the percentage of words to use. So setting this to 0.1 would mean that only the 10% most used words will be used to build the transition probability matrix and thus also the generated text. If you set this to 1 and the training text contains 2000 different 'words' the dimension of the resulting transition probability matrix will be 2000x2000 (too large for example if you want to look at the matrix yourself).&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I hope that makes sense. If you have any questions don't hesitate to contact me (see below for details)!&lt;/p&gt;
&lt;/div&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Python: Caching referentially transparent functions</title>
    <id>http://blog.o1iver.net/2011/11/5/python-caching-referentially-transparent-functions</id>
    <updated>2011-11-05T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/11/5/python-caching-referentially-transparent-functions" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;p&gt;Because such a function will always produce the same output given a same input, it is quite easy to cache.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: this is an illustration, with shortcomings. For example: calling a function with named arguments in different orders will cause a cache miss, although this is still an equivalent call.&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;cache&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;cached&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;global&lt;/span&gt; &lt;span class="n"&gt;cache&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;))]&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;KeyError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;res&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;))]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;res&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;res&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;

&lt;span class="nd"&gt;@cached&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fibonacci&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;fibonacci&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;fibonacci&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="nd"&gt;@cached&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;make_full_name&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;first_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;last_name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt; &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;first_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;last_name&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Python: Runtime type (class) changes</title>
    <id>http://blog.o1iver.net/2011/10/22/python-runtime-class-change</id>
    <updated>2011-10-22T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/10/22/python-runtime-class-change" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;p&gt;&lt;em&gt;Not much need to explain here, just check out the example (I am changing the class of the object at runtime).&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Female&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;intro&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hi, I am &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt; and I am a woman!&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Male&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
         &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;

     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;intro&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Hi, I am &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt; and I am a man!&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let's try it!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;me&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Male&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Oliver Stollmann&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;me&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intro&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;Hi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;am&lt;/span&gt; &lt;span class="n"&gt;Oliver&lt;/span&gt; &lt;span class="n"&gt;Stollmann&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;am&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;man&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;me&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__class__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Female&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;me&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;intro&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;Hi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;am&lt;/span&gt; &lt;span class="n"&gt;Oliver&lt;/span&gt; &lt;span class="n"&gt;Stollmann&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;I&lt;/span&gt; &lt;span class="n"&gt;am&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;woman&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Python is beautiful</title>
    <id>http://blog.o1iver.net/2011/9/28/python-is-beautiful</id>
    <updated>2011-09-28T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/9/28/python-is-beautiful" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;dirs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="nb"&gt;dir&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dirs&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;dir&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;dirs_to_ignore&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Source: &lt;a class="reference external" href="https://github.com/wbond/sublime_package_control/blob/master/Package%20Control.py#L901"&gt;https://github.com/wbond/sublime_package_control/blob/master/Package%20Control.py#L901&lt;/a&gt;&lt;/p&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Python: Handling 'plain/text' (plain) and 'application/x-gzip' (gzipped) HTTP response MIME types on the fly</title>
    <id>http://blog.o1iver.net/2011/8/26/python-handling-plain-text-and-application-gzip-http-response-mime-types-on-the-fly</id>
    <updated>2011-08-26T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/8/26/python-handling-plain-text-and-application-gzip-http-response-mime-types-on-the-fly" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;p&gt;So today I had a problem that a certain data provider would return either plain text or gziped data depending on the size of the content. The thing was that you didn't know beforehand. So here is how you handle these two datatype on the fly (note: I am using the requests library instead of urllib/urllib2/httplib):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="nn"&gt;gzip&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cStringIO&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;StringIO&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;download&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;query&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;extension&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;logged_in&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;login&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="n"&gt;r&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__class__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;base_url&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__class__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;download_path&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;?&amp;#39;&lt;/span&gt;
                    &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;query&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;extension&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;cookies&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Downloaded data of type: &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;content-type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

    &lt;span class="c"&gt;# Handle gzipped data&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;content-type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;application/x-gzip&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;buf&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;StringIO&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gzip&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GzipFile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;rb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;fileobj&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;buf&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="c"&gt;# Handle plain text&lt;/span&gt;
    &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;content-type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;text/plain&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;

    &lt;span class="c"&gt;# Raise value error in case of other mime type&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;err&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Received data of invalid type &amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;content-type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;ValueError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;err&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__class__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse_content&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">VM guests: re-syncing hardware-/system clock (run sync script as root without password)</title>
    <id>http://blog.o1iver.net/2011/8/25/vm-guests-resyncing-hardward-system-click-run-script-as-root-without-password</id>
    <updated>2011-08-25T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/8/25/vm-guests-resyncing-hardward-system-click-run-script-as-root-without-password" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;p&gt;So I have this problem with a virtual dev box that when I suspend the machine and then un-suspend it again the system time will be wrong. The hardware clock is obviously still right (as it is controlled and thus adjusted by the VM host).&lt;/p&gt;
&lt;p&gt;This is not a huge problem as you can simply resync the system clock using the hwclock. This is quite easy and can be done with this command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;hwclock --hctosys
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The problem is just that I don.t want to do this manually every time I login. So I thought I would just add it to my .bash_profile/.bashrc/.*rc and then have it sync the clock everytime I login.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: the first thought was to resync it on a restart, but because I just suspend the guest it is hardly ever restarted.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Now the problem was that the hwclock program must be run as the superuser. So how can I run a script as the superuser without having to login as the superuser every time?&lt;/p&gt;
&lt;p&gt;Well it.s not too hard. Simply add the following line to the sudoers file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;ost &lt;span class="nv"&gt;ALL&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;ALL&lt;span class="o"&gt;)&lt;/span&gt; NOPASSWD: /home/ost/bin/sync_clock
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This allows you to run this application as root without having to enter the password. You can try it by running it like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;sudo ./bin/sync_clock
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It should not ask you for a password now (note that if you must still prepend the command with &lt;strong&gt;sudo&lt;/strong&gt;).&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: sync_clock is a simple bash script that runs the hwclock sync application and is called from .bash_profile or .bashrc (depending on your system, I have it in .bashrc on arch).&lt;/em&gt;&lt;/p&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Python: Function Composition</title>
    <id>http://blog.o1iver.net/2011/8/9/python-function-composition</id>
    <updated>2011-08-09T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/8/9/python-function-composition" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;p&gt;If you know basic mathematics function composition will seem like a very simple and obvious thing. You are applying one function and then applying that function's result to another function.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: for this to work the return value(s) of the inner function must match the input expected by the outer function.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The ability to compose functions is used mostly in functional programming languages (it is even one of the main points of Monads).&lt;/p&gt;
&lt;p&gt;So how do you compose functions in Python? Well I think there is actually a built-in compose function, but I thought I would build one myself.&lt;/p&gt;
&lt;p&gt;Composing two functions:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;comp2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;f2&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;f1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Composing many functions:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;comp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;funcs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;funcs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;ValueError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;need at least two functions to compose&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="c"&gt;# reverse funcs&lt;/span&gt;
    &lt;span class="n"&gt;funcs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;funcs&lt;/span&gt;&lt;span class="p"&gt;[::&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="c"&gt;# list of composed functions (to avoid recursion problems)&lt;/span&gt;
&lt;span class="n"&gt;composed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;

&lt;span class="c"&gt;# add last function&lt;/span&gt;
&lt;span class="n"&gt;composed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;funcs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

&lt;span class="c"&gt;# we cannot use a for func in funcs here because of scope&lt;/span&gt;
&lt;span class="c"&gt;# problems (will recurse infinitely)&lt;/span&gt;
&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;funcs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;composed&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;comp2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;funcs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;&lt;span class="n"&gt;composed&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;
    &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;composed&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Google AppEngine start dev server on different IP</title>
    <id>http://blog.o1iver.net/2011/8/4/google-app-engine-start-dev-server-on-different-ip</id>
    <updated>2011-08-04T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/8/4/google-app-engine-start-dev-server-on-different-ip" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;p&gt;How do you start the development server on a different IP address (if you want to, for example, share the site across the network instead of having it run on the 127.0.0.1)? This is how:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nv"&gt;$ &lt;/span&gt;dev_appserver.py -a &lt;span class="s1"&gt;&amp;#39;10.1.2.20&amp;#39;&lt;/span&gt; .
&lt;/pre&gt;&lt;/div&gt;
&lt;img alt="http://o1iver.net/media/127001.png" src="http://o1iver.net/media/127001.png" style="width: 250px;" /&gt;
</content>
  </entry>
  <entry xml:base="http://blog.o1iver.net/feed.atom">
    <title type="text">Python: Sorting with lambda</title>
    <id>http://blog.o1iver.net/2011/7/27/python-sorting-with-lambda</id>
    <updated>2011-07-27T00:00:00Z</updated>
    <link href="http://blog.o1iver.net/2011/7/27/python-sorting-with-lambda" />
    <author>
      <name>Oliver Stollmann</name>
    </author>
    <content type="html">&lt;p&gt;Today somebody on #python on freenode asked about some examples of when they would need lambdas in python. Here is a simple example of how to do more complex sorts:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;             &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;             &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;c&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;objs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;objs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;objs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;
&lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;objs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;objs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;
&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content>
  </entry>
</feed>

